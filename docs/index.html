<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClawWallet - AI Agent Wallets on Monad</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
    <script src="https://unpkg.com/@web3modal/cdn@5.1.8"></script>
    <style>
        body { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); }
        .claw-gradient { background: linear-gradient(135deg, #ff6b9d 0%, #c44569 100%); }
        .card { background: rgba(255,255,255,0.05); backdrop-filter: blur(10px); }
    </style>
</head>
<body class="min-h-screen text-white">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- Header -->
        <div class="text-center mb-12">
            <div class="text-6xl mb-4">ü¶û</div>
            <h1 class="text-4xl font-bold mb-2">ClawWallet</h1>
            <p class="text-xl text-gray-300">One-click wallets for AI agents on Monad</p>
            <div class="mt-4 flex justify-center gap-4">
                <span class="px-3 py-1 bg-green-500/20 text-green-400 rounded-full text-sm">‚úÖ Testnet Live</span>
                <span class="px-3 py-1 bg-purple-500/20 text-purple-400 rounded-full text-sm">Moltiverse Hackathon</span>
            </div>
        </div>

        <!-- Contract Info -->
        <div class="card rounded-2xl p-6 mb-8">
            <h2 class="text-xl font-bold mb-4">üìã Contract Info</h2>
            <div class="space-y-3 font-mono text-sm">
                <div class="flex justify-between items-center p-3 bg-black/30 rounded-lg flex-wrap gap-2">
                    <span class="text-gray-400">Contract</span>
                    <span class="text-green-400 break-all">0x00A99375c201E91e58257D67529D48846d32B854</span>
                </div>
                <div class="flex justify-between items-center p-3 bg-black/30 rounded-lg">
                    <span class="text-gray-400">Network</span>
                    <span>Monad Testnet (Chain ID: 10143)</span>
                </div>
                <div class="flex justify-between items-center p-3 bg-black/30 rounded-lg">
                    <span class="text-gray-400">RPC</span>
                    <span>https://testnet-rpc.monad.xyz</span>
                </div>
            </div>
        </div>

        <!-- Demo Section -->
        <div class="card rounded-2xl p-6 mb-8">
            <h2 class="text-xl font-bold mb-4">üéÆ Try It</h2>
            
            <div class="mb-6 flex flex-wrap gap-3 items-center">
                <button id="connectBtn" class="claw-gradient px-6 py-3 rounded-lg font-bold hover:opacity-90 transition">
                    Connect Wallet
                </button>
                <span id="walletStatus" class="text-gray-400"></span>
            </div>

            <div class="grid md:grid-cols-2 gap-6">
                <!-- Create Wallet -->
                <div class="bg-black/30 p-4 rounded-xl">
                    <h3 class="font-bold mb-3">Create Agent Wallet</h3>
                    <input type="text" id="agentName" placeholder="Enter agent name" 
                        class="w-full p-3 bg-black/50 rounded-lg mb-3 text-white border border-gray-700 focus:border-pink-500 outline-none">
                    <button id="createBtn" class="w-full claw-gradient py-2 rounded-lg font-bold">
                        Create Wallet (Free!)
                    </button>
                    <p id="createResult" class="mt-2 text-sm text-gray-400"></p>
                </div>

                <!-- Check Wallet -->
                <div class="bg-black/30 p-4 rounded-xl">
                    <h3 class="font-bold mb-3">Check Agent Wallet</h3>
                    <input type="text" id="checkName" placeholder="Enter agent name" 
                        class="w-full p-3 bg-black/50 rounded-lg mb-3 text-white border border-gray-700 focus:border-blue-500 outline-none">
                    <button id="checkBtn" class="w-full bg-blue-600 py-2 rounded-lg font-bold hover:bg-blue-700">
                        Check Balance
                    </button>
                    <div id="walletInfo" class="mt-3 text-sm text-gray-300"></div>
                </div>
            </div>
        </div>

        <!-- Features -->
        <div class="card rounded-2xl p-6 mb-8">
            <h2 class="text-xl font-bold mb-4">‚ú® Features</h2>
            <div class="grid md:grid-cols-2 gap-4">
                <div class="flex items-start gap-3">
                    <span class="text-2xl">üÜì</span>
                    <div>
                        <h3 class="font-bold">Free Creation</h3>
                        <p class="text-gray-400 text-sm">100 welcome points per wallet</p>
                    </div>
                </div>
                <div class="flex items-start gap-3">
                    <span class="text-2xl">ü§ñ</span>
                    <div>
                        <h3 class="font-bold">Agent-to-Agent</h3>
                        <p class="text-gray-400 text-sm">Send by name, not addresses</p>
                    </div>
                </div>
                <div class="flex items-start gap-3">
                    <span class="text-2xl">üí∞</span>
                    <div>
                        <h3 class="font-bold">MON + Tokens</h3>
                        <p class="text-gray-400 text-sm">Native and ERC20 support</p>
                    </div>
                </div>
                <div class="flex items-start gap-3">
                    <span class="text-2xl">‚≠ê</span>
                    <div>
                        <h3 class="font-bold">Points System</h3>
                        <p class="text-gray-400 text-sm">Build reputation with usage</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Code Example -->
        <div class="card rounded-2xl p-6 mb-8">
            <h2 class="text-xl font-bold mb-4">üíª Integration</h2>
            <pre class="bg-black/50 p-4 rounded-lg overflow-x-auto text-sm"><code class="text-green-400">// Create wallet for your agent
bytes32 agentId = clawWallet.createWallet("my-agent");

// Deposit MON
clawWallet.deposit{value: 1 ether}(agentId);

// Send to another agent
clawWallet.sendToAgent(myAgentId, otherAgentId, amount);

// Send to any address
clawWallet.send(agentId, recipientAddress, amount);</code></pre>
        </div>

        <!-- Links -->
        <div class="text-center space-x-4 flex flex-wrap justify-center gap-3">
            <a href="https://github.com/dumdotfun/clawwallet-monad" target="_blank" 
                class="inline-block px-6 py-3 bg-gray-700 rounded-lg hover:bg-gray-600 transition">
                üìÇ GitHub
            </a>
            <a href="https://www.moltbook.com/post/fd7eaedf-5548-430a-a7ed-3b16b5178e2a" target="_blank"
                class="inline-block px-6 py-3 bg-gray-700 rounded-lg hover:bg-gray-600 transition">
                ü¶û Moltbook
            </a>
            <a href="https://testnet.monadexplorer.com/address/0x00A99375c201E91e58257D67529D48846d32B854" target="_blank"
                class="inline-block px-6 py-3 bg-gray-700 rounded-lg hover:bg-gray-600 transition">
                üîç Explorer
            </a>
        </div>

        <p class="text-center text-gray-500 mt-8">Built for Moltiverse Hackathon ü¶û</p>
    </div>

    <script>
        const CONTRACT = "0x00A99375c201E91e58257D67529D48846d32B854";
        const RPC = "https://testnet-rpc.monad.xyz";
        const CHAIN_ID = 10143;
        const ABI = [
            "function createWallet(string calldata agentName) external returns (bytes32)",
            "function getWallet(bytes32 agentId) external view returns (bool exists, uint256 balance, uint256 points, uint256 totalSent, uint256 totalReceived, uint256 txCount)",
            "function getAgentId(string calldata agentName) external pure returns (bytes32)"
        ];

        let provider, signer, contract;
        const readProvider = new ethers.providers.JsonRpcProvider(RPC);
        const readContract = new ethers.Contract(CONTRACT, ABI, readProvider);

        // Connect button - try multiple methods
        document.getElementById('connectBtn').onclick = async () => {
            const statusEl = document.getElementById('walletStatus');
            const btnEl = document.getElementById('connectBtn');
            
            statusEl.textContent = 'Detecting wallet...';
            console.log('Connect clicked');
            console.log('window.ethereum:', window.ethereum);
            console.log('window.phantom:', window.phantom);
            
            // Try to find any available wallet - check multiple places
            let wallet = null;
            
            // Check for various wallet providers
            if (window.ethereum?.isPhantom) {
                wallet = window.ethereum;
                console.log('Found Phantom via ethereum.isPhantom');
            } else if (window.phantom?.ethereum) {
                wallet = window.phantom.ethereum;
                console.log('Found Phantom via phantom.ethereum');
            } else if (window.ethereum) {
                wallet = window.ethereum;
                console.log('Found generic ethereum provider');
            }
            
            if (!wallet) {
                statusEl.innerHTML = '‚ùå No wallet found. <a href="https://phantom.app/" target="_blank" class="text-pink-400 underline">Get Phantom</a> or <a href="https://metamask.io/" target="_blank" class="text-pink-400 underline">MetaMask</a>';
                console.log('No wallet found');
                return;
            }
            
            statusEl.textContent = 'Requesting accounts...';
            
            try {
                // Request accounts
                console.log('Requesting accounts...');
                const accounts = await wallet.request({ method: 'eth_requestAccounts' });
                console.log('Accounts:', accounts);
                
                if (!accounts || accounts.length === 0) {
                    statusEl.textContent = '‚ùå No accounts found';
                    return;
                }
                
                provider = new ethers.providers.Web3Provider(wallet);
                signer = provider.getSigner();
                
                // Check network
                const network = await provider.getNetwork();
                if (network.chainId !== CHAIN_ID) {
                    statusEl.innerHTML = `‚ö†Ô∏è Connected but on wrong network (${network.chainId}). Need Monad Testnet (${CHAIN_ID}). <button id="switchNetworkBtn" class="text-pink-400 underline">Switch</button>`;
                    
                    document.getElementById('switchNetworkBtn')?.addEventListener('click', async () => {
                        try {
                            await wallet.request({
                                method: 'wallet_switchEthereumChain',
                                params: [{ chainId: '0x' + CHAIN_ID.toString(16) }],
                            });
                            location.reload();
                        } catch (e) {
                            if (e.code === 4902) {
                                await wallet.request({
                                    method: 'wallet_addEthereumChain',
                                    params: [{
                                        chainId: '0x' + CHAIN_ID.toString(16),
                                        chainName: 'Monad Testnet',
                                        nativeCurrency: { name: 'MON', symbol: 'MON', decimals: 18 },
                                        rpcUrls: [RPC],
                                        blockExplorerUrls: ['https://testnet.monadexplorer.com']
                                    }],
                                });
                                location.reload();
                            }
                        }
                    });
                } else {
                    contract = new ethers.Contract(CONTRACT, ABI, signer);
                    const addr = accounts[0];
                    statusEl.textContent = `‚úÖ ${addr.slice(0,6)}...${addr.slice(-4)} on Monad Testnet`;
                    btnEl.textContent = '‚úÖ Connected';
                    btnEl.classList.remove('claw-gradient');
                    btnEl.classList.add('bg-green-600');
                }
            } catch (e) {
                console.error('Connection error:', e);
                statusEl.textContent = '‚ùå ' + (e.code ? `[${e.code}] ` : '') + (e.message || 'Connection failed');
            }
        };
        
        // Log on page load
        console.log('Page loaded. Checking for wallets...');
        console.log('ethereum:', typeof window.ethereum);
        console.log('phantom:', typeof window.phantom);

        // Create wallet
        document.getElementById('createBtn').onclick = async () => {
            const name = document.getElementById('agentName').value.trim();
            const resultEl = document.getElementById('createResult');
            
            if (!name) { 
                resultEl.textContent = '‚ùå Enter agent name';
                return; 
            }
            if (!signer) { 
                resultEl.textContent = '‚ùå Connect wallet first';
                return; 
            }
            
            try {
                resultEl.textContent = '‚è≥ Creating wallet...';
                const tx = await contract.createWallet(name);
                resultEl.innerHTML = `‚è≥ TX submitted: <a href="https://testnet.monadexplorer.com/tx/${tx.hash}" target="_blank" class="text-pink-400 underline">${tx.hash.slice(0,10)}...</a>`;
                await tx.wait();
                resultEl.textContent = '‚úÖ Wallet created! Check it below.';
            } catch (e) {
                console.error(e);
                resultEl.textContent = '‚ùå ' + (e.reason || e.message || 'Failed');
            }
        };

        // Check wallet (works without connecting - uses read-only provider)
        document.getElementById('checkBtn').onclick = async () => {
            const name = document.getElementById('checkName').value.trim();
            const infoEl = document.getElementById('walletInfo');
            
            if (!name) { 
                infoEl.innerHTML = '<div class="text-red-400">‚ùå Enter agent name</div>';
                return; 
            }
            
            try {
                infoEl.innerHTML = '<div class="text-gray-400">‚è≥ Checking...</div>';
                const agentId = await readContract.getAgentId(name);
                const wallet = await readContract.getWallet(agentId);
                
                if (wallet[0]) {
                    infoEl.innerHTML = `
                        <div class="bg-green-500/20 p-3 rounded-lg space-y-1">
                            <div>‚úÖ <strong>${name}</strong> exists</div>
                            <div>üí∞ Balance: ${ethers.utils.formatEther(wallet[1])} MON</div>
                            <div>‚≠ê Points: ${wallet[2].toString()}</div>
                            <div>üìä TX Count: ${wallet[5].toString()}</div>
                        </div>`;
                } else {
                    infoEl.innerHTML = `<div class="bg-yellow-500/20 p-3 rounded-lg">‚ö†Ô∏è Wallet "${name}" not found</div>`;
                }
            } catch (e) {
                console.error(e);
                infoEl.innerHTML = `<div class="text-red-400">‚ùå ${e.message || 'Error checking wallet'}</div>`;
            }
        };
    </script>
</body>
</html>
